{% extends 'base.html' %}
{% load static %}

{% block content %}

    {% if request.user.is_authenticated %}

        <div class="container">
            <h3>{{ user.username }},Welcome to our homepage!</h3>

            <div class="row">
                <div class="col">
                    <form action="{% url 'tweets:post' %}" method="post">
                        {% csrf_token %}

                        <input type="text" class="form-control" name="content" placeholder="Write something here..">
                        <button class="btn btn-primary">Send</button>
                    </form>
                </div>
            </div>

            <hr>


            {% for liked, tweet in zipped %}
                <div class="jumbotron">
                    <b>{{ tweet.user.username }}</b>:
                    <p>{{ tweet.content }}</p>
                    <hr class="my-4">
                    {% if tweet.comment_set %}
                        {% for c in tweet.comment_set.all %}
                            <p><b>{{ c }}</b> says: {{ c.content }}</p>
                        {% endfor %}
                    {% endif %}
                    <a class="btn btn-primary " href="{% url 'tweets:comment' tweet.id %}" role="button">Comment</a>
                    <form action="{% url 'tweets:index' %}" method="post" change-data-url="{% url 'tweets:index' %}">
                        {% csrf_token %}
                        {#                        {% if tweet.is_liked %}#}
                        {#                            <button class="btn btn-danger" name="post_id" value="{{ tweet.id }}">Dislike</button>#}
                        {#                        {% else %}#}
{#                        {% if tweet.likes_set. %}#}
                        {% if liked %}
                            <button class="btn btn-danger like_btn" name="post_id" state="dislike" value="{{ tweet.id }}">Dislike</button>
                        {% else %}
                            <button class="btn btn-danger like_btn" name="post_id" state="like" value="{{ tweet.id }}">Like</button>
                        {% endif %}
                        {#                        {% endif %}#}
                    </form>
                    <p><span id="like_cnt">{{ tweet.likes_set.count }}</span> Like{{ tweet.likes_set.count|pluralize }}</p>
                </div>
                <hr>
            {% endfor %}
            {% else %}
            <div class="container">
                <div class="row">
                    <div class="col">
                        <h3>You should first log in to see the content.</h3>
                        <a href="{% url 'tweets:login' %}">Log in now</a>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}


{% endblock %}

{% block script %}
    <script src="{% static 'tweets/index.js' %}"></script>
{% endblock %}





